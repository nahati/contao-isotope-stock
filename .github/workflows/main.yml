name: Code Quality

on: [push, pull_request]

jobs:
  check-code-quality:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '7.4'
    - name: Install Composer
      run: |
        php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
        php composer-setup.php --install-dir=/usr/local/bin --filename=composer
    - name: Install Dependencies
      run: |
        composer install --no-interaction --no-ansi --no-progress --no-suggest --prefer-dist
    - name: Run ECS
      run: |
        vendor/bin/ecs check --no-progress
    - name: Run PHPStan
      run: |
        vendor/bin/phpstan analyse --no-progress --no-interaction --level=5 src
